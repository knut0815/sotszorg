function drawMap(mapWrapper,chartClass,colorScale,colorVar,mapTitle,width,height,margin){var mapScale=width+margin.left+margin.right>450?5500:4250,mapMove=width+margin.left+margin.right>450?40:20,projection=d3.geo.mercator().center(d3.geo.centroid(gemeentesGeo)).scale(mapScale).translate([width/2+mapMove,height/2+10]),path=d3.geo.path().projection(projection),fadeinFunc="chartZZP1_4"===chartClass?fadeIn:fadeIn2,fadeoutFunc="chartZZP1_4"===chartClass?fadeOut:fadeOut2;mapWrapper.selectAll("path").data(gemeentesGeo.features).enter().append("path").attr("d",path).attr("id",function(t){return t.properties.GM_CODE}).attr("class",function(){return"gemeenteMap"}).style("opacity",1).style("stroke-width",1).style("stroke","white").style("fill",function(d){return void 0===GM_CODES[d.properties.GM_CODE]?"#DCDCDC":colorScale(eval("gemeentes[GM_CODES[d.properties.GM_CODE]]."+colorVar))}).on("mouseover",fadeinFunc).on("mouseout",fadeoutFunc),mapWrapper.append("g").append("text").attr("class","map title").attr("transform","translate("+width/2+","+-margin.top/2+")").style("text-anchor","middle").style("font-size","16px").attr("x",0).attr("y",0).attr("dy","0.35em").text(mapTitle).call(wrap,.9*width)}function drawHistoLegend(data,width,height,margin,colorScale,xVar,wrapper,title,yoff){var legendWidth=160,legendHeight=40,steps=30,xoff=12,xstep=legendWidth/steps,Min=d3.min(data,function(d){return eval("d."+xVar)}),Max=d3.max(data,function(d){return eval("d."+xVar)});wrapper.attr("transform","translate("+margin.left+","+(margin.top+height-legendHeight-yoff)+")"),legendArray=data.map(function(d){return eval("d."+xVar)}).sort(function(t,e){return t-e});var xLegend=d3.scale.linear().domain([Min,Max]).range([0,steps*xstep]).nice(),increment=(xLegend.domain()[1]-xLegend.domain()[0])/steps,bin=d3.scale.quantize().domain(xLegend.domain()).range(d3.range(0,steps)),binfreq={};d3.range(0,steps).forEach(function(t){binfreq[t]=0}),legendArray.forEach(function(t){binfreq[bin(t)]+=1}),yLegend=d3.scale.linear().range([legendHeight,0]).domain([0,d3.max(d3.range(0,steps),function(t){return binfreq[t]})]);var legendAxis=d3.svg.axis().orient("bottom").ticks(6).tickFormat(numFormatPercent).scale(xLegend);wrapper.append("g").attr("class","x axis small").attr("transform","translate(0,"+(legendHeight+15)+")").call(legendAxis),eval("var colorDomain = ["+colorScale.domain()+"];");var colorStart=colorDomain;colorStart.unshift(xLegend.domain()[0]),eval("var colorDomain = ["+colorScale.domain()+"];");var colorWidth=colorDomain;colorWidth.push(xLegend.domain()[1]),wrapper.append("g").selectAll(".colorkey").data(colorDomain).enter().append("rect").attr("class","colorkey").attr("x",function(t,e){return xLegend(colorStart[e])}).attr("y",legendHeight+3).attr("width",function(t,e){return xLegend(colorWidth[e])-xLegend(colorStart[e])}).attr("height",9).attr("fill",function(t){return colorScale(t-1e-4)}),wrapper.append("g").selectAll(".colorbars").data(d3.range(0,steps)).enter().append("rect").attr("class","colorbars").attr("x",function(t){return t*xstep}).attr("y",function(t){return yLegend(binfreq[t])}).attr("width",xstep-1).attr("height",function(t){return legendHeight-yLegend(binfreq[t])}).attr("fill",function(t){return colorScale(increment*t+xLegend.domain()[0])}),wrapper.append("text").attr("class","legendTitle").attr("transform","translate("+legendWidth/2+","+(legendHeight+15+35)+")").attr("x",0).attr("y",0).attr("dy","0em").style("text-anchor","middle").style("font-size","10px").text(title).call(wrap,1.2*legendWidth),wrapper.append("rect").attr("x",1.1*legendWidth).attr("y",legendHeight+3).attr("width",18).attr("height",9).style("fill","#DCDCDC"),wrapper.append("text").attr("class","legendTitle").attr("x",1.1*legendWidth+23).attr("y",legendHeight+3).attr("dy","0.75em").style("text-anchor","start").style("font-size","9px").text("onbekend")}function drawClusterLegend(t,e,r,a){t.attr("transform","translate("+a.left+","+(a.top+r-50)+")").style("visibility","hidden"),t.append("rect").attr("class","legendRect greenSquare").attr("x",0).attr("y",0).attr("width",15).attr("height",15).style("fill","#81BC00"),t.append("text").attr("class","legendTitle greenSquare").attr("x",23).attr("y",0).attr("dy","1.25em").style("text-anchor","start").style("font-size","9px").text(""),t.append("rect").attr("class","legendRect darkblueSquare").attr("x",0).attr("y",20).attr("width",15).attr("height",15).style("fill","#00A1DE"),t.append("text").attr("class","legendTitle darkblueSquare").attr("x",23).attr("y",20).attr("dy","1.25em").style("text-anchor","start").style("font-size","9px").text(""),t.append("rect").attr("class","legendRect lightblueSquare").attr("x",0).attr("y",40).attr("width",15).attr("height",15).style("fill","#00A1DE"),t.append("text").attr("class","legendTitle lightblueSquare").attr("x",23).attr("y",40).attr("dy","1.25em").style("text-anchor","start").style("font-size","9px").text(""),t.append("text").attr("class","legendTitle legendSub").attr("x",30).attr("y",55).attr("dy","1.25em").style("text-anchor","start").style("font-size","9px").text("aantal inwoners, inkomen, leeftijdsverdeling en % huurwoningen")}function drawCallout(t,e,r){var a=0,l=a+190;t.append("text").attr("class","callout").attr("id","callout_title").attr("transform","translate("+a+",10)").style("font-size","12px").style("fill","#0D0D0D").text("Groningen"),t.append("text").attr("class","callout").style("fill","#6E6E6E").attr("transform","translate("+a+",35)").text(e),t.append("text").attr("class","callout").style("fill","#6E6E6E").attr("transform","translate("+a+",50)").text(r),t.append("text").attr("class","callout").attr("id","callout_top").attr("transform","translate("+l+",35)").text("346"),t.append("text").attr("class","callout").attr("id","callout_bottom").attr("transform","translate("+l+",50)").text("3467"),t.append("line").attr("class","callout line").style("stroke-width",1).style("stroke","#D1D1D1").style("shape-rendering","crispEdges").attr("x1",0).attr("x2",1.1*l).attr("y1",17).attr("y2",17)}function drawScatter(data,wrapper,width,height,margin,xScale,yScale,rScale,xAxis,xVar,yVar,rVar,colorVar,chartTitle,xLabel,yLabel){wrapper.append("g").attr("class","x axis").attr("transform","translate(0,"+(height+10)+")").call(xAxis);var yAxis=d3.svg.axis().orient("left").ticks(4).tickFormat(numFormatPercent).scale(yScale);wrapper.append("g").attr("class","y axis").attr("transform","translate(0,0)").call(yAxis);var fadeinFunc="chartZZP1_4"===wrapper.attr("class")?fadeIn:fadeIn2,fadeoutFunc="chartZZP1_4"===wrapper.attr("class")?fadeOut:fadeOut2;wrapper.selectAll(".circleScatter").data(data).enter().append("circle").attr("class",function(t){return void 0!=t.GM_CODE?"circleScatter gemeente "+t.GM_CODE:"circleScatter zorgkantoor ZC"+t.Zorgkantoorcode}).style("opacity",.6).style("fill",function(d){return"#"==colorVar.charAt(0)?colorVar:color(eval("d."+colorVar))}).attr("cx",function(d){return xScale(eval("d."+xVar))}).attr("cy",function(d){return yScale(eval("d."+yVar))}).attr("r",function(d){return rScale(eval("d."+rVar))});var voronoi=d3.geom.voronoi().x(function(d){return xScale(eval("d."+xVar))}).y(function(d){return yScale(eval("d."+yVar))}).clipExtent([[0,0],[width,height]]),voronoiGroup=wrapper.append("g").attr("class","voronoi");voronoiGroup.selectAll("path").data(voronoi(data)).enter().append("path").attr("d",function(t){return void 0!=t?"M"+t.join("L")+"Z":void 0}).datum(function(t){return void 0!=t?t.point:void 0}).attr("class",function(t){return void 0!=t?void 0!=t.GM_CODE?"voronoiCells gemeente "+t.GM_CODE:"voronoiCells zorgkantoor ZC"+t.Zorgkantoorcode:void 0}).on("mouseover",fadeinFunc).on("mouseout",fadeoutFunc),wrapper.append("g").append("text").attr("class","x axis label").attr("text-anchor","middle").attr("transform","translate("+width/2+","+(height+2*margin.bottom/3+10)+")").style("font-size","10px").text(xLabel),wrapper.append("g").append("text").attr("x",0).attr("y",0).attr("dy","0.35em").attr("class","y axis label").attr("text-anchor","middle").attr("transform","translate(0,-30)").style("font-size","10px").text(yLabel).call(wrap,100),wrapper.append("g").append("text").attr("class","chartTitle").attr("transform","translate("+width/2+","+1*-margin.top/2+")").style("text-anchor","middle").style("font-size","14px").text(chartTitle)}function drawTopScatter(t,e,r){function a(t){return t.ZZP1_4_Perc>0&t.AANT_INW>5e3?!0:!1}var l=gemeentes.filter(a),n=d3.scale.log().range([0,t]).domain([5e3,1e6]),o=d3.svg.axis().orient("bottom").scale(n).tickFormat(function(t){return n.tickFormat(mobileScreen?3:8,function(t){var e=d3.formatPrefix(t);return e.scale(t)+e.symbol})(t)}),i=d3.scale.linear().range([e,0]).domain(d3.extent(l,function(t){return t.ZZP1_4_Perc})).nice(),c=d3.scale.sqrt().range([0,mobileScreen?10:20]).domain([0,d3.max(l,function(t){return t.ZZP1_4})]);drawScatter(l=l,wrapper=chartTop,t,e,r,n,i,c,o,xVar="AANT_INW",yVar="ZZP1_4_Perc",rVar="ZZP1_4",colorVar="#00A1DE",chartTitle="Overzicht van gemeentes",xLabel="Aantal inwoners | [LET OP: Logarithmische schaal]",yLabel="Lichte t.o.v. totale intramurale zorg");var s=d3.nest().rollup(function(t){return d3.mean(t,function(t){return t.ZZP1_4_Perc})}).entries(l),p=chartTop.append("g").attr("class","median").attr("transform","translate(0,"+i(s)+")").style("cursor","default");p.append("line").attr("x1",n.range()[0]).attr("x2",n.range()[1]).attr("y1",0).attr("y2",0).style("stroke","#B5B5B5").style("shape-rendering","crispEdges").style("stroke-dasharray","2 2").style("pointer-events","none"),p.append("text").attr("class","legendText").attr("transform","translate(5,8)").style("text-anchor","start").text("Gemiddelde");var d=chartTop.append("g").attr("class","legendWrapper").attr("transform","translate("+(scatterWidth-10)+","+(mobileScreen?-20:15)+")");if(bubbleLegend(d,c,legendSizes=[2e3,500,50],legendName="Lichte intramurale zorg die verdwijnt"),!mobileScreen){var g=chartTop.append("g").attr("class","legendWrapper").attr("transform","translate("+(scatterWidth-110)+",15)");g.append("text").attr("class","legendTitle").attr("transform","translate(0,-25)").attr("x","0px").attr("y","0px").attr("dy","1em").text("Elke cirkel is een gemeente").call(wrap,80),g.append("circle").attr("r",c(500)).attr("class","legendCircle").attr("cx",0).attr("cy",c(500)+7)}}function drawBottomScatter(t,e,r){var a=zorgkantoor,l=d3.scale.linear().range([0,t]).domain([0,d3.max(a,function(t){return t.AANT_INW})]).nice(),n=d3.svg.axis().orient("bottom").scale(l).ticks(6).tickFormat(d3.format("s")),o=d3.scale.linear().range([e,0]).domain([.1,.4]).nice(),i=d3.scale.sqrt().range([0,mobileScreen?10:20]).domain([0,d3.max(a,function(t){return t.ZZP1_4})]);drawScatter(a=a,wrapper=chartBottom,t,e,r,l,o,i,n,xVar="AANT_INW",yVar="ZZP1_4_Perc",rVar="ZZP1_4",colorVar="#00A1DE",chartTitle="Overzicht van zorgkantoorregio's",xLabel="Aantal inwoners",yLabel="Lichte t.o.v. totale intramurale zorg");var c=chartBottom.append("g").attr("class","legendWrapper").attr("transform","translate("+(scatterWidth-10)+","+(mobileScreen?-20:15)+")");if(bubbleLegend(c,i,legendSizes=[3e3,1e3,200],legendName="Lichte intramurale zorg die verdwijnt"),!mobileScreen){var s=chartBottom.append("g").attr("class","legendWrapper").attr("transform","translate("+(scatterWidth-110)+",15)");s.append("text").attr("class","legendTitle").attr("transform","translate(0,-25)").attr("x","0px").attr("y","0px").attr("dy","1em").text("Elke cirkel is een zorgkantoor regio").call(wrap,90),s.append("circle").attr("r",i(1e3)).attr("class","legendCircle").attr("cx",0).attr("cy",i(1e3)+7)}}function searchEventLowZZP(t){""!=t?fadeIn(t):fadeOut()}function fadeIn(t){if("string"==typeof t){var e=!1,r={GM_NAAM:t,GM_CODE:GM_NAMES[t]},a=d3.select(".circleScatter.gemeente."+r.GM_CODE).data()[0];clusterLegendWrapper.select(".legendTitle.greenSquare").text("Gekozen gemeente"),clusterLegendWrapper.select(".legendTitle.darkblueSquare").text("Bijbehorende zorgkantoor regio - In onderste cirkel plot"),clusterLegendWrapper.select(".legendTitle.lightblueSquare").text("Vergelijkbare gemeentes, o.b.v:"),clusterLegendWrapper.select(".legendRect.lightblueSquare").style("opacity",.4),clusterLegendWrapper.select(".legendTitle.legendSub").style("opacity",1)}else if(hasClass(d3.select(this),"gemeente")){var e=chartTop,r=t,l=".dataresource.zzp1_4.chartTop",n=t.GM_NAAM,o=chartTop.selectAll(".circleScatter.gemeente."+t.GM_CODE),a=r;clusterLegendWrapper.select(".legendTitle.greenSquare").text("Gekozen gemeente"),clusterLegendWrapper.select(".legendTitle.darkblueSquare").text("Bijbehorende zorgkantoor regio - In onderste cirkel plot"),clusterLegendWrapper.select(".legendTitle.lightblueSquare").text("Vergelijkbare gemeentes, o.b.v:"),clusterLegendWrapper.select(".legendRect.lightblueSquare").style("opacity",.4),clusterLegendWrapper.select(".legendTitle.legendSub").style("opacity",1)}else if(hasClass(d3.select(this),"zorgkantoor")){var e=chartBottom,r=t,l=".dataresource.zzp1_4.chartBottom",n=t.Zorgkantoor,o=chartBottom.selectAll(".circleScatter.zorgkantoor.ZC"+t.Zorgkantoorcode),a=void 0;clusterLegendWrapper.select(".legendTitle.greenSquare").text("Gekozen zorgkantoor regio"),clusterLegendWrapper.select(".legendTitle.darkblueSquare").text("Bijbehorende gemeentes - In bovenste cirkel plot"),clusterLegendWrapper.select(".legendTitle.lightblueSquare").text(""),clusterLegendWrapper.select(".legendRect.lightblueSquare").style("opacity",0),clusterLegendWrapper.select(".legendTitle.legendSub").style("opacity",0)}else if(hasClass(d3.select(this),"gemeenteMap")){var e=!1,r=t.properties,a=d3.select(".circleScatter.gemeente."+r.GM_CODE).data()[0];clusterLegendWrapper.select(".legendTitle.greenSquare").text("Gekozen gemeente"),clusterLegendWrapper.select(".legendTitle.darkblueSquare").text("Bijbehorende zorgkantoor regio - In onderste cirkel plot"),clusterLegendWrapper.select(".legendTitle.lightblueSquare").text("Vergelijkbare gemeentes, o.b.v:"),clusterLegendWrapper.select(".legendRect.lightblueSquare").style("opacity",.4),clusterLegendWrapper.select(".legendTitle.legendSub").style("opacity",1)}var i=[];void 0!=a&&gemeentes.forEach(function(t){if(t.perc_rental===a.perc_rental&t.city_level===a.city_level&t.common_age===a.common_age&t.common_income===a.common_income)if(3===a.city_level&(t.AANT_INW<a.AANT_INW-1e4|t.AANT_INW>a.AANT_INW+1e4));else i.push(t.GM_CODE)}),void 0!=n&&($(o).popover({placement:"auto top",container:l,trigger:"manual",html:!0,content:function(){return"<p style='font-size: 11px; text-align: center;'>"+n+"</p>"}}),$(o).popover("show")),0!=e&&(e.append("g").attr("class","guide").append("line").attr("x1",o.attr("cx")).attr("x2",o.attr("cx")).attr("y1",+o.attr("cy")).attr("y2",scatterHeight+10).style("stroke","#81BC00").style("opacity",0).style("pointer-events","none").transition().duration(400).style("opacity",.5),e.append("g").attr("class","guide").append("line").attr("x1",+o.attr("cx")).attr("x2",0).attr("y1",o.attr("cy")).attr("y2",o.attr("cy")).style("stroke","#81BC00").style("opacity",0).style("pointer-events","none").transition().duration(400).style("opacity",.5)),"string"==typeof t?(mapCallout.selectAll("#callout_title").text(r.GM_NAAM),void 0===GM_CODES[t.GM_CODE]?(mapCallout.selectAll("#callout_top").text("-"),mapCallout.selectAll("#callout_bottom").text("-")):(mapCallout.selectAll("#callout_top").text(numFormatThousands(gemeentes[GM_CODES[r.GM_CODE]].ZZP1_4)),mapCallout.selectAll("#callout_bottom").text(numFormatPercent(gemeentes[GM_CODES[r.GM_CODE]].ZZP1_4_Perc))),map.selectAll("path").style("fill",function(t){return t.properties.GM_CODE==r.GM_CODE?"#81BC00":$.inArray(t.properties.GM_CODE,i)>-1?"#00A1DE":"#A3A3A3"}).style("opacity",function(t){return $.inArray(t.properties.GM_CODE,i),t.properties.GM_CODE==r.GM_CODE?1:$.inArray(t.properties.GM_CODE,i)>-1?.4:.2}),chartTop.selectAll(".circleScatter.gemeente").style("fill",function(t){return t.GM_CODE==r.GM_CODE?"#81BC00":"#00A1DE"}).style("opacity",function(t){return $.inArray(t.GM_CODE,i),t.GM_CODE==r.GM_CODE?1:$.inArray(t.GM_CODE,i)>-1?.4:.02}),chartBottom.selectAll(".circleScatter.zorgkantoor").style("opacity",function(t){return t.Zorgkantoorcode==zorgkantoorById[r.GM_CODE]?1:.1})):hasClass(d3.select(this),"gemeente")?(mapCallout.selectAll("#callout_title").text(r.GM_NAAM),mapCallout.selectAll("#callout_top").text(numFormatThousands(r.ZZP1_4)),mapCallout.selectAll("#callout_bottom").text(numFormatPercent(r.ZZP1_4_Perc)),map.selectAll("path").style("fill",function(t){return t.properties.GM_CODE==r.GM_CODE?"#81BC00":$.inArray(t.properties.GM_CODE,i)>-1?"#00A1DE":"#A3A3A3"}).style("opacity",function(t){return $.inArray(t.properties.GM_CODE,i),t.properties.GM_CODE==r.GM_CODE?1:$.inArray(t.properties.GM_CODE,i)>-1?.4:.2}),chartTop.selectAll(".circleScatter.gemeente").style("fill",function(t){return t.GM_CODE==r.GM_CODE?"#81BC00":"#00A1DE"}).style("opacity",function(t){return $.inArray(t.GM_CODE,i),t.GM_CODE==r.GM_CODE?1:$.inArray(t.GM_CODE,i)>-1?.4:.02}),chartBottom.selectAll(".circleScatter.zorgkantoor").style("opacity",function(t){return t.Zorgkantoorcode==r.Zorgkantoorcode?1:.1})):hasClass(d3.select(this),"zorgkantoor")?(mapCallout.selectAll("#callout_title").text(r.Zorgkantoor),mapCallout.selectAll("#callout_top").text(numFormatThousands(10*Math.ceil(r.ZZP1_4/10))),mapCallout.selectAll("#callout_bottom").text(numFormatPercent(r.ZZP1_4_Perc)),map.selectAll("path").style("opacity",.2),map.selectAll("path").filter(function(t){return zorgkantoorById[t.properties.GM_CODE]==r.Zorgkantoorcode}).style("opacity",1),chartTop.selectAll(".circleScatter.gemeente").style("opacity",function(t){return t.Zorgkantoorcode==r.Zorgkantoorcode?1:.04}),chartBottom.selectAll(".circleScatter.zorgkantoor").style("fill",function(t){return t.Zorgkantoorcode==r.Zorgkantoorcode?"#81BC00":"#00A1DE"}).style("opacity",function(t){return t.Zorgkantoorcode==r.Zorgkantoorcode?1:.1})):hasClass(d3.select(this),"gemeenteMap")&&(mapCallout.selectAll("#callout_title").text(r.GM_NAAM),void 0===GM_CODES[t.properties.GM_CODE]?(mapCallout.selectAll("#callout_top").text("-"),mapCallout.selectAll("#callout_bottom").text("-")):(mapCallout.selectAll("#callout_top").text(numFormatThousands(gemeentes[GM_CODES[r.GM_CODE]].ZZP1_4)),mapCallout.selectAll("#callout_bottom").text(numFormatPercent(gemeentes[GM_CODES[r.GM_CODE]].ZZP1_4_Perc))),map.selectAll("path").style("fill",function(t){return t.properties.GM_CODE==r.GM_CODE?"#81BC00":$.inArray(t.properties.GM_CODE,i)>-1?"#00A1DE":"#A3A3A3"}).style("opacity",function(t){return $.inArray(t.properties.GM_CODE,i),t.properties.GM_CODE==r.GM_CODE?1:$.inArray(t.properties.GM_CODE,i)>-1?.4:.2}),chartTop.selectAll(".circleScatter.gemeente").style("fill",function(t){return t.GM_CODE==r.GM_CODE?"#81BC00":"#00A1DE"}).style("opacity",function(t){return $.inArray(t.GM_CODE,i),t.GM_CODE==r.GM_CODE?1:$.inArray(t.GM_CODE,i)>-1?.4:.02}),chartBottom.selectAll(".circleScatter.zorgkantoor").style("opacity",function(t){return t.Zorgkantoorcode==zorgkantoorById[r.GM_CODE]?1:.1})),mapCallout.style("visibility","visible"),mapLegendWrapper.style("visibility","hidden"),clusterLegendWrapper.style("visibility","visible")}function fadeOut(){mapLegendWrapper.style("visibility","visible"),clusterLegendWrapper.style("visibility","hidden"),mapCallout.style("visibility","hidden"),map.selectAll("path").style("opacity",1).style("fill",function(t){return void 0===GM_CODES[t.properties.GM_CODE]?"#DCDCDC":color(gemeentes[GM_CODES[t.properties.GM_CODE]].ZZP1_4_Perc)}),chartTop.selectAll(".circleScatter").style("fill","#00A1DE").style("opacity",.6),chartBottom.selectAll(".circleScatter").style("fill","#00A1DE").style("opacity",.6),d3.selectAll(".guide").transition().duration(100).style("opacity",0).remove(),$(".popover").each(function(){$(this).remove()})}var mobileScreen=$(window).width()>400?!1:!0,scatterMargin={left:60,top:mobileScreen?90:60,right:40,bottom:50},scatterWidth=Math.min($(".dataresource.zzp1_4.chartTop").width(),500)-scatterMargin.left-scatterMargin.right,scatterHeight=3*scatterWidth/5,svgChartTop=d3.select(".dataresource.zzp1_4.chartTop").append("svg").attr("width",scatterWidth+scatterMargin.left+scatterMargin.right).attr("height",scatterHeight+scatterMargin.top+scatterMargin.bottom),svgChartBottom=d3.select(".dataresource.zzp1_4.chartBottom").append("svg").attr("width",scatterWidth+scatterMargin.left+scatterMargin.right).attr("height",scatterHeight+scatterMargin.top+scatterMargin.bottom),chartTop=svgChartTop.append("g").attr("class","chartZZP1_4").attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")"),chartBottom=svgChartBottom.append("g").attr("class","chartZZP1_4").attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")"),mapWidth=scatterWidth,mapHeight=Math.max(670,2*$(".dataresource.zzp1_4.chartTop").height())-scatterMargin.top-scatterMargin.bottom-50,svgMap=d3.select(".dataresource.zzp1_4.map").append("svg").attr("width",mapWidth+scatterMargin.left+scatterMargin.right).attr("height",mapHeight+scatterMargin.top+scatterMargin.bottom),map=svgMap.append("g").attr("class","map").attr("transform","translate("+scatterMargin.left+","+scatterMargin.top+")"),mapCallout=svgMap.append("g").attr("class","mapCallout").attr("transform","translate("+scatterMargin.left+","+5*scatterMargin.top/4+")").style("visibility","hidden"),mapLegendWrapper=svgMap.append("g").attr("class","legend"),clusterLegendWrapper=svgMap.append("g").attr("class","legend"),gemeentes=gemeentes.filter(function(t){return t.ZZP1_4_Perc>=0}),zorgkantoorById=[],GM_CODES=[],GM_NAMES=[],allGemeentes=[];gemeentes.forEach(function(t,e){zorgkantoorById[t.GM_CODE]=t.Zorgkantoorcode,GM_CODES[t.GM_CODE]=e,GM_NAMES[t.GM_NAAM]=t.GM_CODE,allGemeentes[e]=t.GM_NAAM});var gemeenteById={};zorgkantoor.forEach(function(t){gemeenteById[t.Zorgkantoorcode]=t.GM_CODE});var color=d3.scale.threshold().range(["#bdd7e7","#59afe1","#0d80c4","#08519c"]).domain([.2,.4,.6]),color2=d3.scale.threshold().range(["#7fbc41","#bdd7e7","#6baed6","#3182bd","#08519c"]).domain([0,.15,.3,.5]);drawTopScatter(scatterWidth,scatterHeight,scatterMargin),drawBottomScatter(scatterWidth,scatterHeight,scatterMargin),drawMap(mapWrapper=map,chartClass="chartZZP1_4",colorScale=color,colorVar="ZZP1_4_Perc",mapTitle="De afname van de lichte t.o.v. de totale intramurale zorg per gemeente",width=mapWidth,height=mapHeight,margin=scatterMargin),drawHistoLegend(data=gemeentes,width=mapWidth,height=mapHeight,margin=scatterMargin,colorScale=color,xVar="ZZP1_4_Perc",wrapper=mapLegendWrapper,title="% lichte t.o.v. totale intramurale zorgaanbod",yoff=30),drawClusterLegend(wrapper=clusterLegendWrapper,width=mapWidth,height=mapHeight,margin=scatterMargin),drawCallout(calloutWrapper=mapCallout,topText="Lichte zorgaanbod dat zal verdwijnen",bottomText="% lichte t.o.v. totale intramurale zorg");for(var options=allGemeentes,select=document.getElementById("searchBoxLowZZP"),i=0;i<options.length;i++){var opt=options[i],el=document.createElement("option");el.textContent=opt,el.value=opt,select.appendChild(el)}